<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coin Switch - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        :root {
            --primary: #00276b;
            --secondary: #0004ff;
            --accent: #d0d707;
            --accent-light: #ff8e53;
            --usd-green: #62f500;
            --dark: #00d0ff;
            --darker: #0f0f1e;
            --light: #f8f9fa;
            --success: #32f800;
            --warning: #07c5ff;
            --danger: #dc3545;
            --glass: rgba(255, 255, 255, 0.08);
            --glass-light: rgba(255, 255, 255, 0.12);
            --glass-border: rgba(255, 255, 255, 0.15);
            --gold: #FFD700;
            --platinum: #E5E4E2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--glass);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
            font-size: 22px;
            color: white;
            animation: logo-spin 10s infinite linear;
        }

        @keyframes logo-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .logo-text {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(to right, var(--accent), var(--accent-light));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 14px;
            opacity: 0.8;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }

        /* Tabs */
        .tabs-container {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border-radius: 15px;
            border: 1px solid var(--glass-border);
            margin-bottom: 25px;
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            overflow-x: auto;
            padding: 0 10px;
        }

        .tab {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            border-bottom: 3px solid var(--accent);
            background: rgba(255, 255, 255, 0.05);
        }

        .tab-content {
            display: none;
            padding: 20px;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid var(--glass-border);
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #11998e);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #c82333);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #007bff);
        }

        /* Status badges */
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .status-approved {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .status-rejected {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        /* Search and Filters */
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.15);
            color: white;
            font-size: 14px;
        }

        .filter-select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.15);
            color: white;
            font-size: 14px;
            min-width: 150px;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
        }

        .page-btn {
            padding: 8px 12px;
            border-radius: 5px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-btn.active {
            background: var(--accent);
            color: black;
        }

        .page-btn:hover:not(.active) {
            background: var(--glass-light);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--darker);
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.15);
            color: white;
            font-size: 14px;
        }

        /* Login Screen */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .login-box {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .login-title {
            text-align: center;
            margin-bottom: 25px;
            font-size: 24px;
            font-weight: 600;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: all 0.4s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-weight: 500;
            backdrop-filter: blur(10px);
            transform: translateX(100%);
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .search-box, .filter-select {
                min-width: 100%;
            }
            
            .data-table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="login-box">
            <div class="logo-container" style="justify-content: center; margin-bottom: 20px;">
                <div class="logo"><i class="fas fa-coins"></i></div>
                <div class="logo-text">Coin Switch</div>
            </div>
            <div class="login-title">Admin Panel</div>
            <div class="form-group">
                <label for="admin-email">Email</label>
                <input type="email" id="admin-email" class="form-control" placeholder="admin@example.com">
            </div>
            <div class="form-group">
                <label for="admin-password">Password</label>
                <input type="password" id="admin-password" class="form-control" placeholder="Enter your password">
            </div>
            <button id="login-btn" class="btn" style="width: 100%; padding: 12px; margin-top: 10px;">Login</button>
            <div id="login-error" style="color: var(--danger); text-align: center; margin-top: 15px; display: none;">
                Invalid credentials. Please try again.
            </div>
        </div>
    </div>

    <!-- Main Admin Panel (Hidden until login) -->
    <div id="admin-panel" style="display: none;">
        <div class="container">
            <header>
                <div class="logo-container">
                    <div class="logo"><i class="fas fa-coins"></i></div>
                    <div class="logo-text">Coin Switch Admin</div>
                </div>
                <p class="subtitle">Manage Users, Transactions, and System Settings</p>
                <div style="position: absolute; top: 20px; right: 20px;">
                    <button id="logout-btn" class="btn btn-danger"><i class="fas fa-sign-out-alt"></i> Logout</button>
                </div>
            </header>

            <!-- Dashboard Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-users">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-deposits">$0</div>
                    <div class="stat-label">Total Deposits</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-withdrawals">$0</div>
                    <div class="stat-label">Total Withdrawals</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pending-requests">0</div>
                    <div class="stat-label">Pending Requests</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs-container">
                <div class="tabs">
                    <div class="tab active" data-tab="users">Users</div>
                    <div class="tab" data-tab="deposits">Deposit Requests</div>
                    <div class="tab" data-tab="withdrawals">Withdrawal Requests</div>
                    <div class="tab" data-tab="settings">Settings</div>
                </div>

                <!-- Users Tab -->
                <div class="tab-content active" id="users-tab">
                    <div class="search-container">
                        <input type="text" id="user-search" class="search-box" placeholder="Search users by ID, name, or email">
                        <select id="user-filter" class="filter-select">
                            <option value="all">All Users</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                        <button id="refresh-users" class="btn"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User ID</th>
                                    <th>CS Balance</th>
                                    <th>USD Balance</th>
                                    <th>Hash Power</th>
                                    <th>Level</th>
                                    <th>Referrals</th>
                                    <th>Joined</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- Users will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination" id="users-pagination">
                        <!-- Pagination will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Deposits Tab -->
                <div class="tab-content" id="deposits-tab">
                    <div class="search-container">
                        <input type="text" id="deposit-search" class="search-box" placeholder="Search deposits by user ID or transaction hash">
                        <select id="deposit-filter" class="filter-select">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                        <button id="refresh-deposits" class="btn"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Request ID</th>
                                    <th>User ID</th>
                                    <th>Amount</th>
                                    <th>Transaction Hash</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="deposits-table-body">
                                <!-- Deposits will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination" id="deposits-pagination">
                        <!-- Pagination will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Withdrawals Tab -->
                <div class="tab-content" id="withdrawals-tab">
                    <div class="search-container">
                        <input type="text" id="withdrawal-search" class="search-box" placeholder="Search withdrawals by user ID or address">
                        <select id="withdrawal-filter" class="filter-select">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                        <button id="refresh-withdrawals" class="btn"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Request ID</th>
                                    <th>User ID</th>
                                    <th>Amount</th>
                                    <th>USDT Address</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="withdrawals-table-body">
                                <!-- Withdrawals will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination" id="withdrawals-pagination">
                        <!-- Pagination will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-content" id="settings-tab">
                    <h3 style="margin-bottom: 20px;">System Settings</h3>
                    <div class="form-group">
                        <label for="cs-token-price">CS Token Price (USD)</label>
                        <input type="number" id="cs-token-price" class="form-control" step="0.01" min="0.01">
                    </div>
                    <div class="form-group">
                        <label for="tap-reward">Tap Reward (CS Tokens)</label>
                        <input type="number" id="tap-reward" class="form-control" step="0.1" min="0.1">
                    </div>
                    <div class="form-group">
                        <label for="min-withdrawal">Minimum Withdrawal (USD)</label>
                        <input type="number" id="min-withdrawal" class="form-control" step="1" min="1">
                    </div>
                    <div class="form-group">
                        <label for="hash-to-cs">Hash to CS Conversion Rate</label>
                        <input type="number" id="hash-to-cs" class="form-control" step="0.01" min="0.01">
                    </div>
                    <button id="save-settings" class="btn btn-success"><i class="fas fa-save"></i> Save Settings</button>
                    
                    <h3 style="margin: 30px 0 15px;">Package Management</h3>
                    <div id="packages-list">
                        <!-- Packages will be populated by JavaScript -->
                    </div>
                    <button id="add-package" class="btn" style="margin-top: 15px;"><i class="fas fa-plus"></i> Add New Package</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Details Modal -->
    <div id="user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">User Details</div>
                <button class="close-modal">&times;</button>
            </div>
            <div id="user-details">
                <!-- User details will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Deposit Details Modal -->
    <div id="deposit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Deposit Request Details</div>
                <button class="close-modal">&times;</button>
            </div>
            <div id="deposit-details">
                <!-- Deposit details will be populated by JavaScript -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="approve-deposit" class="btn btn-success" style="flex: 1;">Approve</button>
                <button id="reject-deposit" class="btn btn-danger" style="flex: 1;">Reject</button>
            </div>
        </div>
    </div>

    <!-- Withdrawal Details Modal -->
    <div id="withdrawal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Withdrawal Request Details</div>
                <button class="close-modal">&times;</button>
            </div>
            <div id="withdrawal-details">
                <!-- Withdrawal details will be populated by JavaScript -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="approve-withdrawal" class="btn btn-success" style="flex: 1;">Approve</button>
                <button id="reject-withdrawal" class="btn btn-danger" style="flex: 1;">Reject</button>
            </div>
        </div>
    </div>

    <!-- Package Modal -->
    <div id="package-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="package-modal-title">Add Package</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="package-title">Package Title</label>
                <input type="text" id="package-title" class="form-control">
            </div>
            <div class="form-group">
                <label for="package-price">Price (USD)</label>
                <input type="number" id="package-price" class="form-control" step="1" min="1">
            </div>
            <div class="form-group">
                <label for="package-hash">Hash Power</label>
                <input type="number" id="package-hash" class="form-control" step="10" min="10">
            </div>
            <div class="form-group">
                <label for="package-bonus">Bonus CS Tokens</label>
                <input type="number" id="package-bonus" class="form-control" step="1" min="0">
            </div>
            <div class="form-group">
                <label for="package-daily">Daily USD Earning</label>
                <input type="number" id="package-daily" class="form-control" step="0.01" min="0">
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="package-premium"> Premium Package
                </label>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="save-package" class="btn btn-success" style="flex: 1;">Save</button>
                <button id="delete-package" class="btn btn-danger" style="flex: 1; display: none;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i id="notification-icon" class="fas fa-check-circle"></i>
        <span id="notification-text">Notification Text</span>
    </div>

    <script>
        // Firebase configuration - Use the same as your user app
       const firebaseConfig = {
  apiKey: "AIzaSyCuQF-LPwqDSDEgTdMZMxWe8ThsylWwyZY",
  authDomain: "coinswitchmain-16c88.firebaseapp.com",
  projectId: "coinswitchmain-16c88",
  storageBucket: "coinswitchmain-16c88.firebasestorage.app",
  messagingSenderId: "61325978069",
  appId: "1:61325978069:web:e376a1aed8c77851edb55c",
  measurementId: "G-JMY3WMJJ6B"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const dom = {
                loginScreen: document.getElementById('login-screen'),
                adminPanel: document.getElementById('admin-panel'),
                loginBtn: document.getElementById('login-btn'),
                logoutBtn: document.getElementById('logout-btn'),
                adminEmail: document.getElementById('admin-email'),
                adminPassword: document.getElementById('admin-password'),
                loginError: document.getElementById('login-error'),
                
                // Stats
                totalUsers: document.getElementById('total-users'),
                totalDeposits: document.getElementById('total-deposits'),
                totalWithdrawals: document.getElementById('total-withdrawals'),
                pendingRequests: document.getElementById('pending-requests'),
                
                // Tabs
                tabs: document.querySelectorAll('.tab'),
                tabContents: document.querySelectorAll('.tab-content'),
                
                // Users tab
                userSearch: document.getElementById('user-search'),
                userFilter: document.getElementById('user-filter'),
                refreshUsers: document.getElementById('refresh-users'),
                usersTableBody: document.getElementById('users-table-body'),
                usersPagination: document.getElementById('users-pagination'),
                
                // Deposits tab
                depositSearch: document.getElementById('deposit-search'),
                depositFilter: document.getElementById('deposit-filter'),
                refreshDeposits: document.getElementById('refresh-deposits'),
                depositsTableBody: document.getElementById('deposits-table-body'),
                depositsPagination: document.getElementById('deposits-pagination'),
                
                // Withdrawals tab
                withdrawalSearch: document.getElementById('withdrawal-search'),
                withdrawalFilter: document.getElementById('withdrawal-filter'),
                refreshWithdrawals: document.getElementById('refresh-withdrawals'),
                withdrawalsTableBody: document.getElementById('withdrawals-table-body'),
                withdrawalsPagination: document.getElementById('withdrawals-pagination'),
                
                // Settings tab
                csTokenPrice: document.getElementById('cs-token-price'),
                tapReward: document.getElementById('tap-reward'),
                minWithdrawal: document.getElementById('min-withdrawal'),
                hashToCs: document.getElementById('hash-to-cs'),
                saveSettings: document.getElementById('save-settings'),
                packagesList: document.getElementById('packages-list'),
                addPackage: document.getElementById('add-package'),
                
                // Modals
                userModal: document.getElementById('user-modal'),
                depositModal: document.getElementById('deposit-modal'),
                withdrawalModal: document.getElementById('withdrawal-modal'),
                packageModal: document.getElementById('package-modal'),
                
                // Modal elements
                userDetails: document.getElementById('user-details'),
                depositDetails: document.getElementById('deposit-details'),
                withdrawalDetails: document.getElementById('withdrawal-details'),
                approveDeposit: document.getElementById('approve-deposit'),
                rejectDeposit: document.getElementById('reject-deposit'),
                approveWithdrawal: document.getElementById('approve-withdrawal'),
                rejectWithdrawal: document.getElementById('reject-withdrawal'),
                
                // Package modal elements
                packageModalTitle: document.getElementById('package-modal-title'),
                packageTitle: document.getElementById('package-title'),
                packagePrice: document.getElementById('package-price'),
                packageHash: document.getElementById('package-hash'),
                packageBonus: document.getElementById('package-bonus'),
                packageDaily: document.getElementById('package-daily'),
                packagePremium: document.getElementById('package-premium'),
                savePackage: document.getElementById('save-package'),
                deletePackage: document.getElementById('delete-package'),
                
                // Notification
                notification: document.getElementById('notification'),
                notificationIcon: document.getElementById('notification-icon'),
                notificationText: document.getElementById('notification-text')
            };

            // Global variables
            let currentUser = null;
            let currentDeposit = null;
            let currentWithdrawal = null;
            let currentPackage = null;
            let settings = {};
            let packages = [];
            
            // Pagination variables
            const itemsPerPage = 10;
            let currentUsersPage = 1;
            let currentDepositsPage = 1;
            let currentWithdrawalsPage = 1;
            let filteredUsers = [];
            let filteredDeposits = [];
            let filteredWithdrawals = [];

            // Initialize the app
            const init = () => {
                // Check if user is already logged in
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        // You might want to add a check to ensure only specific admin emails can log in
                        // For example, by checking against a list or a custom claim.
                        currentUser = user;
                        showAdminPanel();
                        loadData();
                    } else {
                        showLoginScreen();
                    }
                });

                // Event listeners
                setupEventListeners();
            };

            // Show login screen
            const showLoginScreen = () => {
                dom.loginScreen.style.display = 'flex';
                dom.adminPanel.style.display = 'none';
            };

            // Show admin panel
            const showAdminPanel = () => {
                dom.loginScreen.style.display = 'none';
                dom.adminPanel.style.display = 'block';
            };

            // Setup event listeners
            const setupEventListeners = () => {
                // Login
                dom.loginBtn.addEventListener('click', handleLogin);
                dom.adminPassword.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleLogin();
                });
                
                // Logout
                dom.logoutBtn.addEventListener('click', handleLogout);
                
                // Tab switching
                dom.tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabId = tab.getAttribute('data-tab');
                        switchTab(tabId);
                    });
                });
                
                // Modal close buttons
                document.querySelectorAll('.close-modal').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.modal').forEach(modal => {
                            modal.style.display = 'none';
                        });
                    });
                });
                
                // Close modal when clicking outside
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.style.display = 'none';
                        }
                    });
                });
                
                // Refresh buttons
                dom.refreshUsers.addEventListener('click', loadUsers);
                dom.refreshDeposits.addEventListener('click', loadDeposits);
                dom.refreshWithdrawals.addEventListener('click', loadWithdrawals);
                
                // Search and filter
                dom.userSearch.addEventListener('input', filterUsers);
                dom.userFilter.addEventListener('change', filterUsers);
                dom.depositSearch.addEventListener('input', filterDeposits);
                dom.depositFilter.addEventListener('change', filterDeposits);
                dom.withdrawalSearch.addEventListener('input', filterWithdrawals);
                dom.withdrawalFilter.addEventListener('change', filterWithdrawals);
                
                // Settings
                dom.saveSettings.addEventListener('click', saveSettings);
                
                // Package management
                dom.addPackage.addEventListener('click', () => {
                    openPackageModal();
                });
                dom.savePackage.addEventListener('click', savePackage);
                dom.deletePackage.addEventListener('click', deletePackage);
            };

            // Handle login
            const handleLogin = () => {
                const email = dom.adminEmail.value;
                const password = dom.adminPassword.value;
                
                dom.loginError.style.display = 'none';

                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Signed in 
                        currentUser = userCredential.user;
                        showNotification('Login successful!', 'success');
                        showAdminPanel();
                        loadData();
                    })
                    .catch((error) => {
                        dom.loginError.textContent = error.message;
                        dom.loginError.style.display = 'block';
                        showNotification('Login failed. Check credentials.', 'error');
                    });
            };

            // Handle logout
            const handleLogout = () => {
                auth.signOut().then(() => {
                    currentUser = null;
                    showLoginScreen();
                    showNotification('Logged out successfully!', 'success');
                }).catch((error) => {
                    console.error('Logout Error:', error);
                    showNotification('Logout failed.', 'error');
                });
            };

            // Switch tabs
            const switchTab = (tabId) => {
                // Update active tab
                dom.tabs.forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.getAttribute('data-tab') === tabId) {
                        tab.classList.add('active');
                    }
                });
                
                // Show active tab content
                dom.tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                    }
                });
                
                // Load data for the tab if needed
                if (tabId === 'users') {
                    loadUsers();
                } else if (tabId === 'deposits') {
                    loadDeposits();
                } else if (tabId === 'withdrawals') {
                    loadWithdrawals();
                } else if (tabId === 'settings') {
                    loadSettings();
                }
            };

            // Load all data
            const loadData = () => {
                loadDashboardStats();
                loadUsers();
                loadDeposits();
                loadWithdrawals();
                loadSettings();
            };

            // Load dashboard statistics
            const loadDashboardStats = async () => {
                try {
                    // Get total users
                    const usersSnapshot = await db.collection('users').get();
                    dom.totalUsers.textContent = usersSnapshot.size;
                    
                    // Get total deposits and withdrawals
                    let totalDeposits = 0;
                    let totalWithdrawals = 0;
                    let pendingRequests = 0;
                    
                    const depositsSnapshot = await db.collection('deposits').get();
                    depositsSnapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.status === 'approved') {
                            totalDeposits += data.amount;
                        }
                        if (data.status === 'pending') {
                            pendingRequests++;
                        }
                    });
                    
                    const withdrawalsSnapshot = await db.collection('withdrawals').get();
                    withdrawalsSnapshot.forEach(doc => {
                        const data = doc.data();
                        if (data.status === 'approved') {
                            totalWithdrawals += data.amount;
                        }
                        if (data.status === 'pending') {
                            pendingRequests++;
                        }
                    });
                    
                    dom.totalDeposits.textContent = `$${totalDeposits.toFixed(2)}`;
                    dom.totalWithdrawals.textContent = `$${totalWithdrawals.toFixed(2)}`;
                    dom.pendingRequests.textContent = pendingRequests;
                } catch (error) {
                    console.error('Error loading dashboard stats:', error);
                    showNotification('Error loading dashboard statistics', 'error');
                }
            };

            // Load users
            const loadUsers = async () => {
                try {
                    const usersSnapshot = await db.collection('users').get();
                    const users = [];
                    
                    usersSnapshot.forEach(doc => {
                        users.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    filteredUsers = users;
                    displayUsers();
                    generatePagination(users.length, currentUsersPage, 'users');
                } catch (error) {
                    console.error('Error loading users:', error);
                    showNotification('Error loading users', 'error');
                }
            };

            // Display users in table
            const displayUsers = () => {
                dom.usersTableBody.innerHTML = '';
                
                const startIndex = (currentUsersPage - 1) * itemsPerPage;
                const endIndex = Math.min(startIndex + itemsPerPage, filteredUsers.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    const user = filteredUsers[i];
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.csBalance ? user.csBalance.toFixed(4) : '0.0000'} CS</td>
                        <td>$${user.usdBalance ? user.usdBalance.toFixed(2) : '0.00'}</td>
                        <td>${user.hashPower || 10} H/s</td>
                        <td>${user.userLevel || 1}</td>
                        <td>${user.referralCount || 0}</td>
                        <td>${user.createdAt ? new Date(user.createdAt.seconds * 1000).toLocaleDateString() : 'N/A'}</td>
                        <td>
                            <button class="btn btn-warning view-user" data-user-id="${user.id}">View</button>
                        </td>
                    `;
                    
                    dom.usersTableBody.appendChild(row);
                }
                
                // Add event listeners to view buttons
                document.querySelectorAll('.view-user').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const userId = btn.getAttribute('data-user-id');
                        viewUserDetails(userId);
                    });
                });
            };

            // Filter users
            const filterUsers = () => {
                const searchTerm = dom.userSearch.value.toLowerCase();
                const filterValue = dom.userFilter.value;
                
                filteredUsers = filteredUsers.filter(user => {
                    const matchesSearch = user.id.toLowerCase().includes(searchTerm);
                    let matchesFilter = true;
                    
                    if (filterValue === 'active') {
                        matchesFilter = user.lastTapTime && (Date.now() - user.lastTapTime < 7 * 24 * 60 * 60 * 1000);
                    } else if (filterValue === 'inactive') {
                        matchesFilter = !user.lastTapTime || (Date.now() - user.lastTapTime >= 7 * 24 * 60 * 60 * 1000);
                    }
                    
                    return matchesSearch && matchesFilter;
                });
                
                currentUsersPage = 1;
                displayUsers();
                generatePagination(filteredUsers.length, currentUsersPage, 'users');
            };

            // View user details
            const viewUserDetails = async (userId) => {
                try {
                    const userDoc = await db.collection('users').doc(userId).get();
                    
                    if (userDoc.exists) {
                        const user = userDoc.data();
                        
                        dom.userDetails.innerHTML = `
                            <div style="margin-bottom: 15px;">
                                <strong>User ID:</strong> ${userId}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>CS Balance:</strong> ${user.csBalance ? user.csBalance.toFixed(4) : '0.0000'} CS
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>USD Balance:</strong> $${user.usdBalance ? user.usdBalance.toFixed(2) : '0.00'}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Hash Power:</strong> ${user.hashPower || 10} H/s
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Level:</strong> ${user.userLevel || 1}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>XP:</strong> ${user.userXP || 0}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Referrals:</strong> ${user.referralCount || 0}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Last Active:</strong> ${user.lastTapTime ? new Date(user.lastTapTime).toLocaleString() : 'Never'}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Purchased Packages:</strong> ${user.purchasedPackages ? user.purchasedPackages.join(', ') : 'None'}
                            </div>
                        `;
                        
                        dom.userModal.style.display = 'flex';
                    } else {
                        showNotification('User not found', 'error');
                    }
                } catch (error) {
                    console.error('Error loading user details:', error);
                    showNotification('Error loading user details', 'error');
                }
            };

            // Load deposits
            const loadDeposits = async () => {
                try {
                    const depositsSnapshot = await db.collection('deposits').orderBy('createdAt', 'desc').get();
                    const deposits = [];
                    
                    depositsSnapshot.forEach(doc => {
                        deposits.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    filteredDeposits = deposits;
                    displayDeposits();
                    generatePagination(deposits.length, currentDepositsPage, 'deposits');
                } catch (error) {
                    console.error('Error loading deposits:', error);
                    showNotification('Error loading deposits', 'error');
                }
            };

            // Display deposits in table
            const displayDeposits = () => {
                dom.depositsTableBody.innerHTML = '';
                
                const startIndex = (currentDepositsPage - 1) * itemsPerPage;
                const endIndex = Math.min(startIndex + itemsPerPage, filteredDeposits.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    const deposit = filteredDeposits[i];
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${deposit.id}</td>
                        <td>${deposit.userId}</td>
                        <td>$${deposit.amount.toFixed(2)}</td>
                        <td>${deposit.transactionHash || 'N/A'}</td>
                        <td><span class="status-badge status-${deposit.status}">${deposit.status}</span></td>
                        <td>${deposit.createdAt ? new Date(deposit.createdAt.seconds * 1000).toLocaleDateString() : 'N/A'}</td>
                        <td>
                            <button class="btn btn-warning view-deposit" data-deposit-id="${deposit.id}">View</button>
                        </td>
                    `;
                    
                    dom.depositsTableBody.appendChild(row);
                }
                
                // Add event listeners to view buttons
                document.querySelectorAll('.view-deposit').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const depositId = btn.getAttribute('data-deposit-id');
                        viewDepositDetails(depositId);
                    });
                });
            };

            // Filter deposits
            const filterDeposits = () => {
                const searchTerm = dom.depositSearch.value.toLowerCase();
                const filterValue = dom.depositFilter.value;
                
                filteredDeposits = filteredDeposits.filter(deposit => {
                    const matchesSearch = deposit.userId.toLowerCase().includes(searchTerm) || 
                                         (deposit.transactionHash && deposit.transactionHash.toLowerCase().includes(searchTerm));
                    const matchesFilter = filterValue === 'all' || deposit.status === filterValue;
                    
                    return matchesSearch && matchesFilter;
                });
                
                currentDepositsPage = 1;
                displayDeposits();
                generatePagination(filteredDeposits.length, currentDepositsPage, 'deposits');
            };

            // View deposit details
            const viewDepositDetails = async (depositId) => {
                try {
                    const depositDoc = await db.collection('deposits').doc(depositId).get();
                    
                    if (depositDoc.exists) {
                        const deposit = depositDoc.data();
                        currentDeposit = { id: depositId, ...deposit };
                        
                        dom.depositDetails.innerHTML = `
                            <div style="margin-bottom: 15px;">
                                <strong>Request ID:</strong> ${depositId}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>User ID:</strong> ${deposit.userId}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Amount:</strong> $${deposit.amount.toFixed(2)}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Transaction Hash:</strong> ${deposit.transactionHash || 'Not provided'}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Status:</strong> <span class="status-badge status-${deposit.status}">${deposit.status}</span>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Date:</strong> ${deposit.createdAt ? new Date(deposit.createdAt.seconds * 1000).toLocaleString() : 'N/A'}
                            </div>
                        `;
                        
                        // Show/hide action buttons based on status
                        if (deposit.status === 'pending') {
                            dom.approveDeposit.style.display = 'block';
                            dom.rejectDeposit.style.display = 'block';
                        } else {
                            dom.approveDeposit.style.display = 'none';
                            dom.rejectDeposit.style.display = 'none';
                        }
                        
                        dom.depositModal.style.display = 'flex';
                    } else {
                        showNotification('Deposit request not found', 'error');
                    }
                } catch (error) {
                    console.error('Error loading deposit details:', error);
                    showNotification('Error loading deposit details', 'error');
                }
            };

            // Approve deposit
            dom.approveDeposit.addEventListener('click', async () => {
                if (!currentDeposit) return;
                
                try {
                    // Update deposit status
                    await db.collection('deposits').doc(currentDeposit.id).update({
                        status: 'approved',
                        approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Update user's USD balance
                    const userDoc = await db.collection('users').doc(currentDeposit.userId).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        await db.collection('users').doc(currentDeposit.userId).update({
                            usdBalance: (userData.usdBalance || 0) + currentDeposit.amount
                        });
                    }
                    
                    showNotification('Deposit approved successfully!', 'success');
                    dom.depositModal.style.display = 'none';
                    loadDeposits();
                    loadDashboardStats();
                } catch (error) {
                    console.error('Error approving deposit:', error);
                    showNotification('Error approving deposit', 'error');
                }
            });

            // Reject deposit
            dom.rejectDeposit.addEventListener('click', async () => {
                if (!currentDeposit) return;
                
                try {
                    await db.collection('deposits').doc(currentDeposit.id).update({
                        status: 'rejected',
                        rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    showNotification('Deposit rejected successfully!', 'success');
                    dom.depositModal.style.display = 'none';
                    loadDeposits();
                    loadDashboardStats();
                } catch (error) {
                    console.error('Error rejecting deposit:', error);
                    showNotification('Error rejecting deposit', 'error');
                }
            });

            // Load withdrawals
            const loadWithdrawals = async () => {
                try {
                    const withdrawalsSnapshot = await db.collection('withdrawals').orderBy('createdAt', 'desc').get();
                    const withdrawals = [];
                    
                    withdrawalsSnapshot.forEach(doc => {
                        withdrawals.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    filteredWithdrawals = withdrawals;
                    displayWithdrawals();
                    generatePagination(withdrawals.length, currentWithdrawalsPage, 'withdrawals');
                } catch (error) {
                    console.error('Error loading withdrawals:', error);
                    showNotification('Error loading withdrawals', 'error');
                }
            };

            // Display withdrawals in table
            const displayWithdrawals = () => {
                dom.withdrawalsTableBody.innerHTML = '';
                
                const startIndex = (currentWithdrawalsPage - 1) * itemsPerPage;
                const endIndex = Math.min(startIndex + itemsPerPage, filteredWithdrawals.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    const withdrawal = filteredWithdrawals[i];
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${withdrawal.id}</td>
                        <td>${withdrawal.userId}</td>
                        <td>$${withdrawal.amount.toFixed(2)}</td>
                        <td>${withdrawal.usdtAddress}</td>
                        <td><span class="status-badge status-${withdrawal.status}">${withdrawal.status}</span></td>
                        <td>${withdrawal.createdAt ? new Date(withdrawal.createdAt.seconds * 1000).toLocaleDateString() : 'N/A'}</td>
                        <td>
                            <button class="btn btn-warning view-withdrawal" data-withdrawal-id="${withdrawal.id}">View</button>
                        </td>
                    `;
                    
                    dom.withdrawalsTableBody.appendChild(row);
                }
                
                // Add event listeners to view buttons
                document.querySelectorAll('.view-withdrawal').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const withdrawalId = btn.getAttribute('data-withdrawal-id');
                        viewWithdrawalDetails(withdrawalId);
                    });
                });
            };

            // Filter withdrawals
            const filterWithdrawals = () => {
                const searchTerm = dom.withdrawalSearch.value.toLowerCase();
                const filterValue = dom.withdrawalFilter.value;
                
                filteredWithdrawals = filteredWithdrawals.filter(withdrawal => {
                    const matchesSearch = withdrawal.userId.toLowerCase().includes(searchTerm) || 
                                         withdrawal.usdtAddress.toLowerCase().includes(searchTerm);
                    const matchesFilter = filterValue === 'all' || withdrawal.status === filterValue;
                    
                    return matchesSearch && matchesFilter;
                });
                
                currentWithdrawalsPage = 1;
                displayWithdrawals();
                generatePagination(filteredWithdrawals.length, currentWithdrawalsPage, 'withdrawals');
            };

            // View withdrawal details
            const viewWithdrawalDetails = async (withdrawalId) => {
                try {
                    const withdrawalDoc = await db.collection('withdrawals').doc(withdrawalId).get();
                    
                    if (withdrawalDoc.exists) {
                        const withdrawal = withdrawalDoc.data();
                        currentWithdrawal = { id: withdrawalId, ...withdrawal };
                        
                        dom.withdrawalDetails.innerHTML = `
                            <div style="margin-bottom: 15px;">
                                <strong>Request ID:</strong> ${withdrawalId}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>User ID:</strong> ${withdrawal.userId}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Amount:</strong> $${withdrawal.amount.toFixed(2)}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>USDT Address:</strong> ${withdrawal.usdtAddress}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Status:</strong> <span class="status-badge status-${withdrawal.status}">${withdrawal.status}</span>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Date:</strong> ${withdrawal.createdAt ? new Date(withdrawal.createdAt.seconds * 1000).toLocaleString() : 'N/A'}
                            </div>
                        `;
                        
                        // Show/hide action buttons based on status
                        if (withdrawal.status === 'pending') {
                            dom.approveWithdrawal.style.display = 'block';
                            dom.rejectWithdrawal.style.display = 'block';
                        } else {
                            dom.approveWithdrawal.style.display = 'none';
                            dom.rejectWithdrawal.style.display = 'none';
                        }
                        
                        dom.withdrawalModal.style.display = 'flex';
                    } else {
                        showNotification('Withdrawal request not found', 'error');
                    }
                } catch (error) {
                    console.error('Error loading withdrawal details:', error);
                    showNotification('Error loading withdrawal details', 'error');
                }
            };

            // Approve withdrawal
            dom.approveWithdrawal.addEventListener('click', async () => {
                if (!currentWithdrawal) return;
                
                try {
                    // Update withdrawal status
                    await db.collection('withdrawals').doc(currentWithdrawal.id).update({
                        status: 'approved',
                        approvedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Deduct from user's USD balance
                    const userDoc = await db.collection('users').doc(currentWithdrawal.userId).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        await db.collection('users').doc(currentWithdrawal.userId).update({
                            usdBalance: (userData.usdBalance || 0) - currentWithdrawal.amount
                        });
                    }
                    
                    showNotification('Withdrawal approved successfully!', 'success');
                    dom.withdrawalModal.style.display = 'none';
                    loadWithdrawals();
                    loadDashboardStats();
                } catch (error) {
                    console.error('Error approving withdrawal:', error);
                    showNotification('Error approving withdrawal', 'error');
                }
            });

            // Reject withdrawal
            dom.rejectWithdrawal.addEventListener('click', async () => {
                if (!currentWithdrawal) return;
                
                try {
                    await db.collection('withdrawals').doc(currentWithdrawal.id).update({
                        status: 'rejected',
                        rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    showNotification('Withdrawal rejected successfully!', 'success');
                    dom.withdrawalModal.style.display = 'none';
                    loadWithdrawals();
                    loadDashboardStats();
                } catch (error) {
                    console.error('Error rejecting withdrawal:', error);
                    showNotification('Error rejecting withdrawal', 'error');
                }
            });

            // Load settings
            const loadSettings = async () => {
                try {
                    const settingsDoc = await db.collection('settings').doc('appSettings').get();
                    
                    if (settingsDoc.exists) {
                        settings = settingsDoc.data();
                        
                        // Update form fields
                        dom.csTokenPrice.value = settings.csTokenPrice || 0.05;
                        dom.tapReward.value = settings.tapReward || 0.5;
                        dom.minWithdrawal.value = settings.minWithdrawal || 10;
                        dom.hashToCs.value = settings.hashToCs || 0.05;
                    }
                    
                    // Load packages
                    const packagesSnapshot = await db.collection('packages').get();
                    packages = [];
                    
                    packagesSnapshot.forEach(doc => {
                        packages.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    displayPackages();
                } catch (error) {
                    console.error('Error loading settings:', error);
                    showNotification('Error loading settings', 'error');
                }
            };

            // Display packages
            const displayPackages = () => {
                dom.packagesList.innerHTML = '';
                
                packages.forEach(pkg => {
                    const packageEl = document.createElement('div');
                    packageEl.className = 'stat-card';
                    packageEl.style.marginBottom = '15px';
                    packageEl.style.textAlign = 'left';
                    packageEl.style.padding = '15px';
                    
                    packageEl.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin-bottom: 5px;">${pkg.title}</h4>
                                <p style="margin-bottom: 5px; font-size: 14px;">Price: $${pkg.price} | Hash Power: ${pkg.hashPower} H/s</p>
                                <p style="margin-bottom: 5px; font-size: 14px;">Bonus CS: ${pkg.bonusCs || 0} | Daily USD: $${pkg.dailyUsd || 0}</p>
                                <p style="font-size: 12px; opacity: 0.7;">ID: ${pkg.id}</p>
                            </div>
                            <div>
                                <button class="btn btn-warning edit-package" data-package-id="${pkg.id}">Edit</button>
                            </div>
                        </div>
                    `;
                    
                    dom.packagesList.appendChild(packageEl);
                });
                
                // Add event listeners to edit buttons
                document.querySelectorAll('.edit-package').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const packageId = btn.getAttribute('data-package-id');
                        openPackageModal(packageId);
                    });
                });
            };

            // Save settings
            const saveSettings = async () => {
                try {
                    const updatedSettings = {
                        csTokenPrice: parseFloat(dom.csTokenPrice.value),
                        tapReward: parseFloat(dom.tapReward.value),
                        minWithdrawal: parseFloat(dom.minWithdrawal.value),
                        hashToCs: parseFloat(dom.hashToCs.value),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    await db.collection('settings').doc('appSettings').set(updatedSettings, { merge: true });
                    settings = updatedSettings;
                    
                    showNotification('Settings saved successfully!', 'success');
                } catch (error) {
                    console.error('Error saving settings:', error);
                    showNotification('Error saving settings', 'error');
                }
            };

            // Open package modal
            const openPackageModal = (packageId = null) => {
                if (packageId) {
                    // Edit existing package
                    currentPackage = packages.find(p => p.id === packageId);
                    dom.packageModalTitle.textContent = 'Edit Package';
                    dom.packageTitle.value = currentPackage.title;
                    dom.packagePrice.value = currentPackage.price;
                    dom.packageHash.value = currentPackage.hashPower;
                    dom.packageBonus.value = currentPackage.bonusCs || 0;
                    dom.packageDaily.value = currentPackage.dailyUsd || 0;
                    dom.packagePremium.checked = currentPackage.isPremium || false;
                    dom.deletePackage.style.display = 'block';
                } else {
                    // Add new package
                    currentPackage = null;
                    dom.packageModalTitle.textContent = 'Add Package';
                    dom.packageTitle.value = '';
                    dom.packagePrice.value = '';
                    dom.packageHash.value = '';
                    dom.packageBonus.value = '';
                    dom.packageDaily.value = '';
                    dom.packagePremium.checked = false;
                    dom.deletePackage.style.display = 'none';
                }
                
                dom.packageModal.style.display = 'flex';
            };

            // Save package
            const savePackage = async () => {
                try {
                    const packageData = {
                        title: dom.packageTitle.value,
                        price: parseFloat(dom.packagePrice.value),
                        hashPower: parseInt(dom.packageHash.value),
                        bonusCs: parseInt(dom.packageBonus.value) || 0,
                        dailyUsd: parseFloat(dom.packageDaily.value) || 0,
                        isPremium: dom.packagePremium.checked,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    if (currentPackage) {
                        // Update existing package
                        await db.collection('packages').doc(currentPackage.id).set(packageData, { merge: true });
                        showNotification('Package updated successfully!', 'success');
                    } else {
                        // Add new package
                        const id = 'pkg_' + Math.random().toString(36).substr(2, 9);
                        await db.collection('packages').doc(id).set({
                            ...packageData,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        showNotification('Package added successfully!', 'success');
                    }
                    
                    dom.packageModal.style.display = 'none';
                    loadSettings();
                } catch (error) {
                    console.error('Error saving package:', error);
                    showNotification('Error saving package', 'error');
                }
            };

            // Delete package
            const deletePackage = async () => {
                if (!currentPackage) return;
                
                if (confirm('Are you sure you want to delete this package?')) {
                    try {
                        await db.collection('packages').doc(currentPackage.id).delete();
                        showNotification('Package deleted successfully!', 'success');
                        dom.packageModal.style.display = 'none';
                        loadSettings();
                    } catch (error) {
                        console.error('Error deleting package:', error);
                        showNotification('Error deleting package', 'error');
                    }
                }
            };

            // Generate pagination
            const generatePagination = (totalItems, currentPage, type) => {
                const totalPages = Math.ceil(totalItems / itemsPerPage);
                let paginationContainer;
                
                if (type === 'users') {
                    paginationContainer = dom.usersPagination;
                } else if (type === 'deposits') {
                    paginationContainer = dom.depositsPagination;
                } else if (type === 'withdrawals') {
                    paginationContainer = dom.withdrawalsPagination;
                } else {
                    return;
                }
                
                paginationContainer.innerHTML = '';
                
                // Previous button
                const prevButton = document.createElement('button');
                prevButton.className = 'page-btn';
                prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
                prevButton.disabled = currentPage === 1;
                prevButton.addEventListener('click', () => {
                    if (type === 'users') {
                        currentUsersPage--;
                        displayUsers();
                    } else if (type === 'deposits') {
                        currentDepositsPage--;
                        displayDeposits();
                    } else if (type === 'withdrawals') {
                        currentWithdrawalsPage--;
                        displayWithdrawals();
                    }
                    generatePagination(totalItems, currentPage - 1, type);
                });
                paginationContainer.appendChild(prevButton);
                
                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    const pageButton = document.createElement('button');
                    pageButton.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                    pageButton.textContent = i;
                    pageButton.addEventListener('click', () => {
                        if (type === 'users') {
                            currentUsersPage = i;
                            displayUsers();
                        } else if (type === 'deposits') {
                            currentDepositsPage = i;
                            displayDeposits();
                        } else if (type === 'withdrawals') {
                            currentWithdrawalsPage = i;
                            displayWithdrawals();
                        }
                        generatePagination(totalItems, i, type);
                    });
                    paginationContainer.appendChild(pageButton);
                }
                
                // Next button
                const nextButton = document.createElement('button');
                nextButton.className = 'page-btn';
                nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
                nextButton.disabled = currentPage === totalPages;
                nextButton.addEventListener('click', () => {
                    if (type === 'users') {
                        currentUsersPage++;
                        displayUsers();
                    } else if (type === 'deposits') {
                        currentDepositsPage++;
                        displayDeposits();
                    } else if (type === 'withdrawals') {
                        currentWithdrawalsPage++;
                        displayWithdrawals();
                    }
                    generatePagination(totalItems, currentPage + 1, type);
                });
                paginationContainer.appendChild(nextButton);
            };

            // Show notification
            const showNotification = (message, type = 'success') => {
                dom.notificationText.textContent = message;
                let iconClass = 'fas fa-check-circle', bgColor = 'var(--success)';
                if (type === 'warning') { iconClass = 'fas fa-exclamation-triangle'; bgColor = 'var(--warning)'; }
                else if (type === 'error') { iconClass = 'fas fa-times-circle'; bgColor = 'var(--danger)'; }
                else if (type === 'info') { iconClass = 'fas fa-info-circle'; bgColor = 'var(--primary)'; }
                dom.notificationIcon.className = iconClass;
                dom.notification.style.background = bgColor;
                dom.notification.classList.add('show');
                setTimeout(() => dom.notification.classList.remove('show'), 3000);
            };

            // Initialize the app
            init();
        });
    </script>
</body>
</html>